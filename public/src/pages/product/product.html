<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos</title>
    <link rel="stylesheet" href="product.css">
    <link rel="icon" href="../../assets/images/LogoIcon.png" type="image/x-icon">
    <script src="../../plugin/notify.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Toastify/1.11.2/Toastify.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Toastify/1.11.2/Toastify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="../../components/prisma/loader.js"></script>
</head>
</head>

<body>
    <script>
        loader();
    </script>
    <!-- Logo do inicio da página -->
    

    <div class="nav">
        <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fw7.pngwing.com%2Fpngs%2F318%2F793%2Fpng-transparent-amd-logo-logos-logos-and-brands-icon.png&f=1&nofb=1&ipt=16bc6ee85242e22d5bc168df2f06ddcccf706db787b32ef0759ab319892eb0ad&ipo=images"
            alt="logo">

        <p class="estrela">&#9733; &#9733; &#9733; &#9733; &#9734;</p>

        <div class="share">
            <p onclick="favoritar()">&#9825;</p> <!-- &#10084; -->
            <img onclick="compartinhar()" src="../../assets/icons/share-svgrepo-com.svg" alt="">
        </div>
    </div>

    <main>

        <figure class="imgProduto">
            <img id="img" src="" alt="product" class="animate__animated animate__fadeIn">
        </figure>

        <section class="body">

            <div class="nome">
                <h2 id="name" class="animate__animated animate__slideInDown"></h2>
            </div>

            <div class="tecshop">
                <p>Vendido e entregue por: <b>Tecshop</b></p>
            </div>

            <div class="preco1">
                <h3 id="preco" class="animate__animated animate__zoomIn"></h3>
            </div>

            </div>

            <div class="opcoes">
                <div>
                    <p>12X VEZES de <span id="p"></span> SEM JUROS</p>
                    <p>À VISTA COM 2% DESCONTO</p>
                </div>
            </div>
            <div class="botaoComprar">
                <button class="botao" onclick="comprar()">COMPRAR</button>
                <div class="addCarrinho">
                    <a href="">
                        <img src="../../assets/icons/shopping-cart-add.png" class="animate__animated animate__lightSpeedInLeft ">
                    </a>
                </div>
            </div>

            <div class="promocao">
                <p></p>
            </div>
        </section>
    </main>

    <article>
        <div class="description">
            <div class="titulo">
                <img src="../../assets/icons/document.png">
                <input type="button" value="DESCRIÇÃO DO PRODUTO">
            </div>
            <div class="descricao">
                <p id="descricao"></p>
            </div>
        </div>

        <div class="info">
            <div class="tituloInfo">
                <img src="../../assets/icons/exclamation.png">
                <input type="button" value="INFORMAÇÕES TÉCNICAS">
            </div>
            <div class="tecnico">
                <p id="tec"></p>
            </div>
        </div>

    </article>


    <script>

        // função para abrir o popup
        function abrirPopup() {
            document.getElementById("meuPopup").style.display = "flex";
            document.body.classList.add("bloqueado");

        }
        // função para fechar o popup
        function fecharPopup() {
            document.getElementById("meuPopup").style.display = "none";
            document.body.classList.remove("bloqueado");
        }

        document.addEventListener('DOMContentLoaded', () => {

            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            let arrayProduto = [];
            let produto;

            arrayProduto = JSON.parse(localStorage.getItem('products'));

            arrayProduto.forEach(element => {
                if (id == element.id) {
                    produto = element;
                    return;
                }
            });

            // Recupere o produto do localStorage


            if (produto) {
                document.getElementById('img').src = produto.img;
                document.getElementById('name').innerText = produto.name;
                document.getElementById('preco').innerText = "R$ " + produto.price;
                document.getElementById('descricao').innerText = produto.description;
                document.getElementById('tec').innerText = produto.infoTech;


                // produto.descricaoProduto = "A amizade consegue ser tão complexa.Deixa uns desanimados, outros bem felizes.É a alimentação dos fracos É o reino dos fortes. Faz-nos cometer erros Os fracos deixam se ir abaixo Os fortes erguem sempre a cabeça Os assim assumem-nos. Sem pensar conquistamos o mundo geral e construímo o nosso pequeno lugar, deixando brilhar cada estrelinha. Estrelinhas. Doces, sensíveis, frias, ternurentas. Mas sempre presentes em qualquer parte. Os donos da amizade.";
                // produto.InformacoesTecnica = "A amizade consegue ser tão complexa.Deixa uns desanimados, outros bem felizes.É a alimentação dos fracos É o reino dos fortes. Faz-nos cometer erros Os fracos deixam se ir abaixo Os fortes erguem sempre a cabeça Os assim assumem-nos. Sem pensar conquistamos o mundo geral e construímo o nosso pequeno lugar, deixando brilhar cada estrelinha. Estrelinhas. Doces, sensíveis, frias, ternurentas. Mas sempre presentes em qualquer parte. Os donos da amizade.";

                // document.getElementById('imgProduto').src = produto.img;
                // document.querySelector('.nome h2').innerText = produto.name;
                // document.querySelector('#preco1').innerText = produto.price;
                // document.querySelector('.descricao p').innerText = produto.description;
                // document.querySelector('.tecnico p').innerText = produto.infoTec;



                // Cálculo do valor parcelado
                const precoFloat = parseFloat(produto.price.replace('R$', '').replace('.', '').replace(',', '.'));
                const parcelado = (precoFloat / 12).toFixed(2).replace('.', ',');

                // Exibe o valor parcelado
                document.querySelector('#p').innerText = parcelado;
            } else {
                console.log("ERRO (>_<)");
            }
        });


        function favoritar() {
            const coracao = document.querySelector('.share p');
            coracao.addEventListener("click", () => {
                // Use os caracteres diretamente
                if (coracao.innerText === '♡') { // Coração vazio
                    coracao.innerText = '❤'; // Muda para coração cheio
                } else {
                    coracao.innerText = '♡'; // Muda para coração vazio
                }
            });
        }

        function compartinhar() {
            const button = document.querySelector('.share img')

            button.addEventListener("click", () => {
                const link = window.location.href
                navigator.clipboard.writeText(link)
                    .then(() => {
                        NotifySuccess("Link copiada com Sucesso 👍") //NÃO FUNCIONA :(
                    })
                    .catch(err => {
                        console.error('Erro ao copiar o link: ', err);
                    });
            })
        }

        function comprar() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            let produto;
            let produtosCarrinho = [];;
            let produtos = [];

            produtos = JSON.parse(localStorage.getItem('products'));

            console.log(produtosCarrinho)

            produtos.forEach(element => {
                if (id == element.id) {
                    produto = element;
                    return;
                }
            });

            produtosCarrinho = JSON.parse(localStorage.getItem("produtoCarrinho"));

            // Adiciona um produto ao carrinho
            produto.quantityCart++;

            let exists = false;

            produtosCarrinho.forEach(element => {
                if (element.id == produto.id) {
                    element.quantityCart++;
                    exists = true;
                    return;
                }
            });

            if (!exists)
                produtosCarrinho.push(produto);

            localStorage.produtoCarrinho = JSON.stringify(produtosCarrinho);

            window.location.href = "../carrinho/Carrinho.html";
        }
    </script>

</body>

</html>